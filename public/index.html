<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»‘å¿ƒå…¬å¸å¤§äº¨ v2.0 - å¤šçº§åˆ¶é€ ç³»ç»Ÿ</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d3436 50%, #636e72 100%);
            color: #ddd;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* æ–°é—»æ»šåŠ¨æ¡æ ·å¼ */
        .news-ticker {
            background: linear-gradient(90deg, #e17055, #d63031);
            color: white;
            padding: 8px 0;
            white-space: nowrap;
            overflow: hidden;
            border-bottom: 2px solid #fdcb6e;
            font-size: 14px;
            font-weight: bold;
        }
        
        .news-content {
            display: inline-block;
            animation: scroll-left 60s linear infinite;
            padding-left: 100%;
        }
        
        @keyframes scroll-left {
            0% { transform: translate3d(100%, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }
        
        /* ç‰ˆæœ¬æ›´æ–°æç¤º */
        .version-banner {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid #fdcb6e;
        }
        
        /* ç™»å½•ç•Œé¢ */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .login-form {
            background: linear-gradient(135deg, #2d3436, #636e72);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.8);
            border: 3px solid #fdcb6e;
            text-align: center;
            color: #ddd;
            max-width: 500px;
            width: 90%;
        }
        
        .login-title {
            font-size: 32px;
            margin-bottom: 10px;
            color: #fdcb6e;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .version-tag {
            font-size: 16px;
            color: #00b894;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .login-subtitle {
            font-size: 16px;
            margin-bottom: 30px;
            color: #ddd;
            font-style: italic;
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #ddd;
            font-size: 16px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .login-input:focus {
            border-color: #fdcb6e;
            outline: none;
            background: rgba(255,255,255,0.15);
        }
        
        .company-type-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .company-type {
            padding: 15px;
            border: 2px solid rgba(253,203,110,0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0,0,0,0.3);
        }
        
        .company-type:hover {
            border-color: #fdcb6e;
            background: rgba(253,203,110,0.1);
        }
        
        .company-type.selected {
            border-color: #fdcb6e;
            background: rgba(253,203,110,0.2);
        }
        
        .company-type-title {
            font-weight: bold;
            color: #fdcb6e;
            margin-bottom: 5px;
        }
        
        .company-type-desc {
            font-size: 12px;
            color: #bbb;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            margin: 20px 0;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(225,112,85,0.4);
        }
        
        .feature-list {
            margin-top: 25px;
            font-size: 14px;
            color: #bbb;
            line-height: 1.8;
            text-align: left;
        }
        
        .feature-item {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feature-icon {
            width: 20px;
            font-size: 16px;
        }
        
        /* æ¸¸æˆä¸»ç•Œé¢ */
        .game-container {
            display: none;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-bottom: 2px solid rgba(253,203,110,0.3);
        }
        
        .company-title {
            text-align: center;
            font-size: 28px;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #fdcb6e, #e17055);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: none;
        }
        
        .company-info {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
        }
        
        .company-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            border: 1px solid rgba(253,203,110,0.2);
        }
        
        .stat-label {
            font-size: 11px;
            color: #bbb;
            margin-bottom: 3px;
        }
        
        .stat-value {
            font-size: 16px;
            font-weight: bold;
            color: #fdcb6e;
        }
        
        /* åº“å­˜æ˜¾ç¤º */
        .inventory {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }
        
        .inventory-item {
            background: linear-gradient(135deg, #2d3436, #636e72);
            color: white;
            padding: 8px 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 11px;
            font-weight: bold;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        
        .inventory-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .inventory-item.money { background: linear-gradient(135deg, #fdcb6e, #e17055); }
        .inventory-item.t1 { background: linear-gradient(135deg, #74b9ff, #0984e3); }
        .inventory-item.t2 { background: linear-gradient(135deg, #a29bfe, #6c5ce7); }
        .inventory-item.t3 { background: linear-gradient(135deg, #fd79a8, #e84393); }
        .inventory-item.t4 { background: linear-gradient(135deg, #00b894, #00a085); }
        .inventory-item.t5 { background: linear-gradient(135deg, #fab1a0, #e17055); }
        
        .global-event-banner {
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 2px solid #fdcb6e;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            min-height: calc(100vh - 200px);
        }
        
        .left-content {
            padding: 20px;
        }
        
        .chart-section {
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .chart-header {
            color: #fdcb6e;
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 15px;
        }
        
        .right-panel {
            background: rgba(0,0,0,0.8);
            border-left: 2px solid rgba(253,203,110,0.3);
            display: flex;
            flex-direction: column;
        }
        
        .chat-section {
            flex: 1;
            padding: 20px;
            border-bottom: 2px solid rgba(253,203,110,0.3);
            min-height: 300px;
        }
        
        .chat-header {
            color: #fdcb6e;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chat-messages {
            height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .chat-message {
            margin-bottom: 10px;
            font-size: 13px;
            line-height: 1.4;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
        }
        
        .chat-time {
            color: #888;
            font-size: 10px;
        }
        
        .chat-player {
            color: #fdcb6e;
            font-weight: bold;
            margin: 0 5px;
        }
        
        .chat-text {
            color: #ddd;
        }
        
        .chat-input-container {
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #ddd;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #fdcb6e;
            background: rgba(255,255,255,0.15);
        }
        
        .chat-send {
            padding: 12px 18px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .chat-send:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(225,112,85,0.4);
        }
        
        .leaderboard {
            padding: 20px;
            flex: 1;
        }
        
        .leaderboard-header {
            color: #fdcb6e;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .company-rank {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, rgba(45,52,54,0.6), rgba(99,110,114,0.6));
            border-radius: 8px;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .company-rank:hover {
            transform: translateX(3px);
        }
        
        .company-rank.player {
            border-left-color: #fdcb6e;
            background: linear-gradient(135deg, rgba(253,203,110,0.15), rgba(225,112,85,0.15));
        }
        
        .company-rank.ai {
            border-left-color: #74b9ff;
        }
        
        .rank-number {
            font-size: 16px;
            font-weight: bold;
            color: #fdcb6e;
            margin-right: 12px;
            min-width: 25px;
        }
        
        .rank-info {
            flex: 1;
        }
        
        .rank-name {
            font-weight: bold;
            color: #ddd;
            margin-bottom: 3px;
            font-size: 13px;
        }
        
        .rank-value {
            font-size: 11px;
            color: #bbb;
        }
        
        .tabs-container {
            background: rgba(0,0,0,0.7);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .tabs-header {
            display: flex;
            background: rgba(0,0,0,0.5);
            overflow-x: auto;
        }
        
        .tab-button {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            color: #bbb;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            font-weight: bold;
            white-space: nowrap;
            min-width: 120px;
        }
        
        .tab-button:hover {
            color: #fdcb6e;
            background: rgba(253,203,110,0.1);
        }
        
        .tab-button.active {
            color: #fdcb6e;
            border-bottom-color: #fdcb6e;
            background: rgba(253,203,110,0.1);
        }
        
        .tab-content {
            padding: 20px;
            display: none;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* å·¥å‚ã€å¸‚åœºã€äº§å“é¡¹ç›®æ ·å¼ */
        .factory-item, .market-section, .product-item, .tech-item {
            background: linear-gradient(135deg, rgba(45,52,54,0.8), rgba(99,110,114,0.8));
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            margin-bottom: 12px;
        }
        
        .factory-item:hover, .product-item:hover, .tech-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(253,203,110,0.2);
            border-color: rgba(253,203,110,0.5);
        }
        
        .factory-item.insufficient, .product-item.insufficient, .tech-item.insufficient {
            opacity: 0.6;
            border-color: rgba(214,48,49,0.5);
        }
        
        .factory-header, .product-header, .tech-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .factory-name, .product-name, .tech-name {
            font-weight: bold;
            color: #fdcb6e;
            font-size: 16px;
        }
        
        .factory-count, .product-price {
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .market-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .market-tier {
            background: rgba(0,0,0,0.6);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid rgba(253,203,110,0.3);
        }
        
        .market-tier.locked {
            opacity: 0.5;
            border-color: rgba(214,48,49,0.5);
        }
        
        .market-tier-header {
            font-weight: bold;
            color: #fdcb6e;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .product-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .multiplier-selector {
            display: flex;
            gap: 5px;
            margin: 8px 0;
            justify-content: center;
        }
        
        .multiplier-btn {
            padding: 4px 8px;
            border: 1px solid #fdcb6e;
            background: transparent;
            color: #fdcb6e;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
        }
        
        .multiplier-btn.active {
            background: #fdcb6e;
            color: #2d3436;
        }
        
        .multiplier-btn:hover {
            background: rgba(253,203,110,0.2);
        }
        
        .btn {
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 8px;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(225,112,85,0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn.buy {
            background: linear-gradient(135deg, #00b894, #00a085);
        }
        
        .btn.sell {
            background: linear-gradient(135deg, #e17055, #d63031);
        }
        
        .btn.build {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: #2d3436;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: #fdcb6e;
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid #fdcb6e;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            max-width: 350px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.3);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.05);
            }
            70% {
                transform: translate(-50%, -50%) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        /* ç”Ÿäº§è¿›åº¦æ¡ */
        .production-progress {
            background: rgba(0,0,0,0.3);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .production-progress-bar {
            background: linear-gradient(90deg, #00b894, #00a085);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        /* äº§å“ç­‰çº§æ ‡è¯† */
        .tier-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .tier-badge.T1 { background: #74b9ff; color: white; }
        .tier-badge.T2 { background: #a29bfe; color: white; }
        .tier-badge.T3 { background: #fd79a8; color: white; }
        .tier-badge.T4 { background: #00b894; color: white; }
        .tier-badge.T5 { background: #fab1a0; color: white; }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(253,203,110,0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(253,203,110,0.7);
        }
        
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .right-panel {
                border-left: none;
                border-top: 2px solid rgba(253,203,110,0.3);
            }
        }
        
        @media (max-width: 768px) {
            .inventory {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .company-info {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .company-type-selector {
                grid-template-columns: 1fr;
            }
            
            .tabs-header {
                justify-content: flex-start;
            }
            
            .market-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ç‰ˆæœ¬æ›´æ–°æ¨ªå¹… -->
    <div class="version-banner">
        ğŸ‰ æ¬¢è¿æ¥åˆ°é»‘å¿ƒå…¬å¸å¤§äº¨ v2.0ï¼å…¨æ–°å¤šçº§äº§å“åˆ¶é€ ç³»ç»Ÿä¸Šçº¿ï¼ğŸ‰
    </div>

    <!-- æ–°é—»æ»šåŠ¨æ¡ -->
    <div class="news-ticker" id="newsTicker">
        <div class="news-content" id="newsContent">
            ğŸ“° å…¨æ–°v2.0ç‰ˆæœ¬ä¸Šçº¿ï¼šå¤šçº§äº§å“åˆ¶é€  | ğŸ­ 5ç§ä¸“ä¸šå·¥å‚ç­‰ä½ å»ºé€  | ğŸŒ 4å±‚å¸‚åœºä½“ç³» | âš¡ 10åˆ†é’Ÿäº‹ä»¶å‘¨æœŸ...
        </div>
    </div>

    <!-- ç™»å½•ç•Œé¢ -->
    <div class="login-screen" id="loginScreen">
        <div class="login-form">
            <div class="login-title">ğŸ¢ é»‘å¿ƒå…¬å¸å¤§äº¨ ğŸ¢</div>
            <div class="version-tag">v2.0 å¤šçº§åˆ¶é€ ç³»ç»Ÿ</div>
            <div class="login-subtitle">"ä»åŸæ–™åˆ°å¥¢ä¾ˆå“çš„å®Œæ•´äº§ä¸šé“¾"</div>
            
            <input type="text" class="login-input" id="companyName" placeholder="è¾“å…¥ä½ çš„åˆ¶é€ å¸å›½åç§°" maxlength="25">
            
            <div style="color: #fdcb6e; font-weight: bold; margin: 20px 0 10px 0;">é€‰æ‹©ä½ çš„ä¸“ä¸šæ–¹å‘ï¼š</div>
            <div class="company-type-selector">
                <div class="company-type" data-type="tech">
                    <div class="company-type-title">ğŸ’» ç§‘æŠ€åˆ¶é€ </div>
                    <div class="company-type-desc">ä¸“ç²¾ç”µå­äº§å“åˆ¶é€ </div>
                </div>
                <div class="company-type" data-type="manufacturing">
                    <div class="company-type-title">ğŸ­ é‡å·¥ä¸š</div>
                    <div class="company-type-desc">é’¢é“æœºæ¢°å¤§è§„æ¨¡ç”Ÿäº§</div>
                </div>
                <div class="company-type" data-type="luxury">
                    <div class="company-type-title">ğŸ’ å¥¢ä¾ˆå“</div>
                    <div class="company-type-desc">é«˜ç«¯äº§å“ç²¾å“è·¯çº¿</div>
                </div>
                <div class="company-type" data-type="energy">
                    <div class="company-type-title">âš¡ èƒ½æºåŒ–å·¥</div>
                    <div class="company-type-desc">èƒ½æºäº§å“ä¾›åº”é“¾</div>
                </div>
            </div>
            
            <button class="login-btn" onclick="joinGame()">å¼€å§‹åˆ¶é€ ä¹‹æ—…</button>
            
            <div class="feature-list">
                <div style="color: #fdcb6e; font-weight: bold; margin-bottom: 10px;">ğŸ†• v2.0 å…¨æ–°ç‰¹æ€§ï¼š</div>
                <div class="feature-item">
                    <span class="feature-icon">ğŸ­</span>
                    <span>5çº§äº§å“åˆ¶é€ é“¾ï¼šåŸæ–™â†’åˆçº§â†’ä¸­çº§â†’é«˜çº§â†’å¥¢ä¾ˆå“</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">ğŸª</span>
                    <span>4å±‚å¸‚åœºä½“ç³»ï¼šæœ¬åœ°â†’å›½å†…â†’å›½é™…â†’å¥¢ä¾ˆå“å¸‚åœº</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">ğŸ¤–</span>
                    <span>æ™ºèƒ½è‡ªåŠ¨åŒ–ï¼šåæœŸå¯è®¾ç½®å…¨è‡ªåŠ¨ç”Ÿäº§</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">â°</span>
                    <span>10åˆ†é’Ÿäº‹ä»¶å‘¨æœŸï¼šæ›´é¢‘ç¹çš„å¸‚åœºå˜åŒ–</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">ğŸ”¬</span>
                    <span>ç§‘æŠ€ç ”å‘æ ‘ï¼šè§£é”æ›´é«˜æ•ˆçš„ç”Ÿäº§æ–¹å¼</span>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div class="game-container" id="gameContainer">
        <div class="header">
            <div class="company-title">ğŸ­ ç°ä»£åˆ¶é€ ä¸šï¼šå¤šçº§äº§å“åˆ¶é€ ç³»ç»Ÿ ğŸ­</div>
            
            <!-- å…¨çƒäº‹ä»¶æ¨ªå¹… -->
            <div class="global-event-banner" id="globalEventBanner" style="display: none;">
                <div id="globalEventText"></div>
            </div>
            
            <div class="company-info">
                <div>
                    <div style="color: #fdcb6e; font-size: 20px; font-weight: bold; margin-bottom: 5px;">
                        <span id="currentCompany">æœªçŸ¥å…¬å¸</span>
                        <span id="companyType" style="font-size: 14px; color: #bbb; margin-left: 10px;">(åˆ¶é€ ä¸š)</span>
                        <span style="background: #00b894; color: white; padding: 4px 8px; border-radius: 10px; font-size: 12px; margin-left: 10px;">
                            Lv.<span id="companyLevel">0</span>
                        </span>
                    </div>
                    <div style="color: #bbb; font-size: 14px;">
                        CEO: <span id="playerName">åŒ¿å</span>
                        <span id="connectionStatus" style="margin-left: 15px; color: #00b894;">â— åœ¨çº¿</span>
                    </div>
                </div>
                
                <div class="company-stats">
                    <div class="stat-item">
                        <div class="stat-label">å…¨çƒæ’å</div>
                        <div class="stat-value" id="globalRank">#-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">åœ¨çº¿CEO</div>
                        <div class="stat-value" id="onlineCount">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">å…¬å¸ä»·å€¼</div>
                        <div class="stat-value" id="companyValue">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ç»éªŒå€¼</div>
                        <div class="stat-value" id="experience">0</div>
                    </div>
                </div>
            </div>
            
            <div class="inventory" id="inventory">
                <!-- åº“å­˜å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="main-layout">
            <div class="left-content">
                <!-- ç”Ÿäº§çŠ¶æ€å›¾ -->
                <div class="chart-section">
                    <div class="chart-header">
                        ğŸ“Š ç”Ÿäº§ç›‘æ§ä¸­å¿ƒ
                        <span style="font-size: 12px; color: #bbb;">å®æ—¶ç”Ÿäº§æ•°æ®</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="productionChart"></canvas>
                    </div>
                </div>
                
                <div class="tabs-container">
                    <div class="tabs-header">
                        <button class="tab-button active" onclick="switchTab('factories')">ğŸ­ å·¥å‚å»ºé€ </button>
                        <button class="tab-button" onclick="switchTab('production')">âš™ï¸ ç”Ÿäº§ç®¡ç†</button>
                        <button class="tab-button" onclick="switchTab('markets')">ğŸª å¸‚åœºäº¤æ˜“</button>
                        <button class="tab-button" onclick="switchTab('research')">ğŸ”¬ ç§‘æŠ€ç ”å‘</button>
                        <button class="tab-button" onclick="switchTab('automation')">ğŸ¤– è‡ªåŠ¨åŒ–</button>
                    </div>
                    
                    <div class="tab-content active" id="factories-tab">
                        <div id="factories"></div>
                    </div>
                    
                    <div class="tab-content" id="production-tab">
                        <div id="production"></div>
                    </div>
                    
                    <div class="tab-content" id="markets-tab">
                        <div id="markets"></div>
                    </div>
                    
                    <div class="tab-content" id="research-tab">
                        <div id="research"></div>
                    </div>
                    
                    <div class="tab-content" id="automation-tab">
                        <div id="automation"></div>
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="chat-section">
                    <div class="chat-header">
                        ğŸ’¬ åˆ¶é€ å•†èŠå¤©å®¤
                        <span style="font-size: 12px; color: #bbb;">å…¨çƒåˆ¶é€ å•†äº¤æµ</span>
                    </div>
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chatInput" placeholder="åˆ†äº«åˆ¶é€ å¿ƒå¾—..." maxlength="200" onkeypress="if(event.key==='Enter') sendMessage()">
                        <button class="chat-send" onclick="sendMessage()">å‘é€</button>
                    </div>
                </div>
                
                <div class="leaderboard">
                    <div class="leaderboard-header">
                        ğŸ† åˆ¶é€ å•†æ’è¡Œæ¦œ
                        <span style="font-size: 12px; color: #bbb;">å…¨çƒåˆ¶é€ å¸å›½æ’å</span>
                    </div>
                    <div id="leaderboard"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class ManufacturingTycoon {
            constructor() {
                this.socket = io();
                this.playerId = null;
                this.companyName = '';
                this.playerName = '';
                this.companyType = 'tech';
                this.isConnected = false;
                this.productionChart = null;
                this.selectedMultiplier = 1;
                this.newsMessages = [];
                
                this.gameData = {
                    version: '2.0.0',
                    inventory: { money: 500000 },
                    factories: {},
                    technologies: [],
                    companyType: 'tech',
                    level: 0,
                    experience: 0,
                    automationSettings: {},
                    lastUpdate: Date.now()
                };
                
                this.productTiers = {};
                this.factoryTypes = {};
                this.marketTiers = {};
                this.techTree = {};
                this.globalMarkets = {};
                this.leaderboard = [];
                this.chatMessages = [];
                this.selectedCompanyType = 'tech';
                this.globalEvent = null;
                
                this.init();
            }
            
            init() {
                this.setupCompanyTypeSelector();
                this.setupSocketListeners();
                this.initCharts();
                this.startNewsUpdate();
            }
            
            setupCompanyTypeSelector() {
                const types = document.querySelectorAll('.company-type');
                types.forEach(type => {
                    type.addEventListener('click', () => {
                        types.forEach(t => t.classList.remove('selected'));
                        type.classList.add('selected');
                        this.selectedCompanyType = type.dataset.type;
                    });
                });
                
                document.querySelector('.company-type[data-type="tech"]').classList.add('selected');
            }
            
            initCharts() {
                const productionCtx = document.getElementById('productionChart').getContext('2d');
                this.productionChart = new Chart(productionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['åŸææ–™', 'åˆçº§äº§å“', 'ä¸­çº§äº§å“', 'é«˜çº§äº§å“', 'å¥¢ä¾ˆå“'],
                        datasets: [{
                            data: [0, 0, 0, 0, 0],
                            backgroundColor: ['#74b9ff', '#a29bfe', '#fd79a8', '#00b894', '#fab1a0'],
                            borderWidth: 2,
                            borderColor: '#2d3436'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#ddd' }
                            }
                        }
                    }
                });
            }

            startNewsUpdate() {
                setInterval(() => {
                    this.updateNews();
                }, 15000);
            }

            updateNews() {
                const newsTemplates = [
                    "ğŸ­ å…¨çƒåˆ¶é€ ä¸šæŒ‡æ•°ä¸Šæ¶¨",
                    "ğŸ“¦ ä¾›åº”é“¾æ•ˆç‡æŒç»­ä¼˜åŒ–", 
                    "âš¡ æ–°èƒ½æºæŠ€æœ¯çªç ´åœ¨å³",
                    "ğŸ¤– è‡ªåŠ¨åŒ–ç¨‹åº¦å†åˆ›æ–°é«˜",
                    "ğŸ’ å¥¢ä¾ˆå“å¸‚åœºéœ€æ±‚æ¿€å¢",
                    "ğŸ”¬ æ–°ææ–™ç ”å‘å–å¾—è¿›å±•",
                    "ğŸŒ å›½é™…è´¸æ˜“æ”¿ç­–è°ƒæ•´",
                    "ğŸ“ˆ åˆ¶é€ ä¸šæ•°å­—åŒ–è½¬å‹åŠ é€Ÿ"
                ];

                const news = newsTemplates[Math.floor(Math.random() * newsTemplates.length)];
                this.addNewsMessage(news);
            }

            addNewsMessage(message) {
                this.newsMessages.push(message);
                if (this.newsMessages.length > 8) {
                    this.newsMessages.shift();
                }
                
                const newsContent = document.getElementById('newsContent');
                newsContent.textContent = this.newsMessages.join(' | ') + ' | ';
            }

            setupSocketListeners() {
                this.socket.on('connect', () => {
                    this.isConnected = true;
                    this.updateConnectionStatus();
                    console.log('ğŸ”— è¿æ¥åˆ°åˆ¶é€ ä¸šæœåŠ¡å™¨');
                });
                
                this.socket.on('disconnect', () => {
                    this.isConnected = false;
                    this.updateConnectionStatus();
                    console.log('ğŸ’” ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥');
                });

                this.socket.on('nameConflict', (data) => {
                    alert(data.message);
                    
                    if (data.suggestion) {
                        const companyInput = document.getElementById('companyName');
                        companyInput.value = data.suggestion;
                        companyInput.focus();
                    }
                    
                    document.getElementById('loginScreen').style.display = 'flex';
                    document.getElementById('gameContainer').style.display = 'none';
                });
                
                this.socket.on('versionReset', (data) => {
                    this.showWelcomeMessage(data.message);
                });
                
                this.socket.on('inheritanceSuccess', (data) => {
                    this.showNotification(`ğŸ“„ ${data.message}`);
                    this.showWelcomeBackEffect(data);
                });
                
                this.socket.on('gameState', (data) => {
                    this.globalMarkets = data.globalMarkets;
                    this.leaderboard = data.leaderboard;
                    this.chatMessages = data.chatMessages;
                    this.globalEvent = data.globalEvent;
                    this.productTiers = data.productTiers;
                    this.factoryTypes = data.factoryTypes;
                    this.marketTiers = data.marketTiers;
                    this.techTree = data.techTree;
                    this.renderAll();
                    this.updateGlobalEvent();
                    console.log('ğŸ“Š æ¥æ”¶åˆ°æ¸¸æˆçŠ¶æ€æ•°æ®');
                });
                
                this.socket.on('marketUpdate', (data) => {
                    if (data.marketType) {
                        this.globalMarkets[data.marketType] = data.market;
                    } else {
                        this.globalMarkets = data;
                    }
                    this.renderMarkets();
                });
                
                this.socket.on('leaderboardUpdate', (leaderboard) => {
                    this.leaderboard = leaderboard;
                    this.renderLeaderboard();
                    this.updateCompanyStats();
                });
                
                this.socket.on('globalEvent', (event) => {
                    this.globalEvent = event;
                    this.updateGlobalEvent();
                    if (event) {
                        this.showNotification(`ğŸŒ å…¨çƒäº‹ä»¶ï¼š${event.name}`);
                    }
                });
                
                this.socket.on('factoryBuilt', (data) => {
                    this.showNotification(`ğŸ­ ${data.message}`);
                    this.gameData.inventory = data.playerData.inventory;
                    this.gameData.factories = data.playerData.factories;
                    this.updateDisplay();
                    this.renderFactories();
                    this.renderProduction();
                });
                
                this.socket.on('productionStarted', (data) => {
                    this.showNotification(`âš™ï¸ å¼€å§‹ç”Ÿäº§ï¼š${data.task.productId}`);
                    this.gameData.inventory = data.playerData.inventory;
                    this.updateDisplay();
                    this.renderProduction();
                });
                
                this.socket.on('productionCompleted', (data) => {
                    this.showNotification(`âœ… ${data.message}`);
                    this.gameData.inventory = data.playerData.inventory;
                    this.gameData.experience = data.playerData.experience;
                    this.updateDisplay();
                    this.renderProduction();
                    this.updateProductionChart();
                });
                
                this.socket.on('tradeSuccess', (data) => {
                    this.showNotification(`ğŸ’° ${data.message}`);
                    this.gameData.inventory = data.playerData.inventory;
                    this.updateDisplay();
                });
                
                this.socket.on('techResearched', (data) => {
                    this.showNotification(`ğŸ”¬ ${data.message} - ${data.effect}`);
                    this.gameData.inventory = data.playerData.inventory;
                    this.gameData.technologies = data.playerData.technologies;
                    this.gameData.factories = data.playerData.factories;
                    this.updateDisplay();
                    this.renderResearch();
                    this.renderFactories();
                });
                
                this.socket.on('chatMessage', (message) => {
                    this.chatMessages.push(message);
                    if (this.chatMessages.length > 50) {
                        this.chatMessages.shift();
                    }
                    this.renderChat();
                });
                
                this.socket.on('companyJoined', (company) => {
                    this.showNotification(`ğŸ¢ ${company.name} è¿›å…¥äº†åˆ¶é€ ä¸šï¼`);
                });
                
                this.socket.on('companyLeft', (company) => {
                    this.showNotification(`ğŸ‘‹ ${company.name} æš‚æ—¶ç¦»å¼€`);
                });
            }

            showWelcomeMessage(message) {
                const welcomeDiv = document.createElement('div');
                welcomeDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, #00b894, #00a085);
                    color: white;
                    padding: 30px;
                    border-radius: 20px;
                    border: 3px solid #fdcb6e;
                    z-index: 9999;
                    text-align: center;
                    font-size: 16px;
                    font-weight: bold;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                    animation: bounceIn 0.6s ease-out;
                    max-width: 500px;
                `;
                
                welcomeDiv.innerHTML = `
                    <div style="font-size: 32px; margin-bottom: 15px;">ğŸ‰ ç‰ˆæœ¬æ›´æ–°ï¼ ğŸ‰</div>
                    <div style="margin-bottom: 15px;">${message}</div>
                    <button onclick="this.parentElement.remove()" style="
                        background: white; color: #00b894; border: none; 
                        padding: 10px 20px; border-radius: 10px; 
                        font-weight: bold; cursor: pointer;">
                        å¼€å§‹ä½“éªŒ
                    </button>
                `;
                
                document.body.appendChild(welcomeDiv);
            }

            showWelcomeBackEffect(data) {
                const welcomeDiv = document.createElement('div');
                welcomeDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, #fdcb6e, #e17055);
                    color: #2d3436;
                    padding: 30px;
                    border-radius: 20px;
                    border: 3px solid #d63031;
                    z-index: 9999;
                    text-align: center;
                    font-size: 18px;
                    font-weight: bold;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                    animation: bounceIn 0.6s ease-out;
                `;
                
                welcomeDiv.innerHTML = `
                    <div style="font-size: 32px; margin-bottom: 15px;">ğŸ‰ æ¬¢è¿å›æ¥ï¼ ğŸ‰</div>
                    <div style="margin-bottom: 10px;">æˆåŠŸç»§æ‰¿åˆ¶é€ å¸å›½</div>
                    <div style="font-size: 14px; color: #636e72;">
                        ç»§æ‰¿ä»·å€¼: ${this.formatNumber(data.inheritedValue)} ğŸ’°<br>
                        ä¸Šæ¬¡åœ¨çº¿: ${new Date(data.lastSeen).toLocaleString()}
                    </div>
                `;
                
                document.body.appendChild(welcomeDiv);
                
                setTimeout(() => {
                    welcomeDiv.remove();
                }, 3000);
            }

            joinGame() {
                const companyInput = document.getElementById('companyName');
                const name = companyInput.value.trim();
                
                if (!name) {
                    alert('è¯·è¾“å…¥ä½ çš„åˆ¶é€ å¸å›½åç§°ï¼');
                    return;
                }
                
                if (name.length > 25) {
                    alert('å…¬å¸åç§°å¤ªé•¿äº†ï¼è¯·æ§åˆ¶åœ¨25ä¸ªå­—ç¬¦å†…');
                    return;
                }
                
                if (!/^[a-zA-Z0-9\u4e00-\u9fa5_\-\s]+$/.test(name)) {
                    alert('å…¬å¸åç§°åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸­æ–‡ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦å’Œç©ºæ ¼');
                    return;
                }
                
                this.companyName = name;
                this.companyType = this.selectedCompanyType;
                this.playerName = name + ' CEO';
                this.playerId = 'company_' + Date.now();
                
                this.gameData.companyType = this.companyType;
                
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
                document.getElementById('currentCompany').textContent = this.companyName;
                document.getElementById('companyType').textContent = `(${this.companyType})`;
                document.getElementById('playerName').textContent = this.playerName;
                
                this.socket.emit('joinGame', {
                    companyName: this.companyName,
                    playerName: this.playerName,
                    companyType: this.companyType,
                    gameData: this.gameData
                });
                
                this.renderAll();
                console.log(`ğŸ® å°è¯•åŠ å…¥æ¸¸æˆ: ${this.companyName}`);
            }

            switchTab(tabName) {
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(`${tabName}-tab`).classList.add('active');
                
                // æ ¹æ®æ ‡ç­¾é¡µæ¸²æŸ“å†…å®¹
                switch(tabName) {
                    case 'factories':
                        this.renderFactories();
                        break;
                    case 'production':
                        this.renderProduction();
                        break;
                    case 'markets':
                        this.renderMarkets();
                        break;
                    case 'research':
                        this.renderResearch();
                        break;
                    case 'automation':
                        this.renderAutomation();
                        break;
                }
            }

            updateGlobalEvent() {
                const banner = document.getElementById('globalEventBanner');
                const text = document.getElementById('globalEventText');
                
                if (this.globalEvent) {
                    banner.style.display = 'block';
                    text.innerHTML = `ğŸŒ <strong>${this.globalEvent.name}</strong>: ${this.globalEvent.description}`;
                } else {
                    banner.style.display = 'none';
                }
            }

            updateConnectionStatus() {
                const statusElement = document.getElementById('connectionStatus');
                if (this.isConnected) {
                    statusElement.textContent = 'â— åœ¨çº¿';
                    statusElement.style.color = '#00b894';
                } else {
                    statusElement.textContent = 'â— ç¦»çº¿';
                    statusElement.style.color = '#d63031';
                }
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 4000);
            }

            renderAll() {
                this.renderFactories();
                this.renderProduction();
                this.renderMarkets();
                this.renderResearch();
                this.renderAutomation();
                this.renderLeaderboard();
                this.renderChat();
                this.updateDisplay();
                this.updateProductionChart();
            }

            renderFactories() {
                const container = document.getElementById('factories');
                container.innerHTML = '';
                
                Object.keys(this.factoryTypes).forEach(factoryType => {
                    const factory = this.factoryTypes[factoryType];
                    const div = document.createElement('div');
                    
                    const canAfford = this.canAfford(factory.cost);
                    const canUnlock = this.gameData.level >= factory.unlockLevel;
                    const ownedCount = Object.values(this.gameData.factories).filter(f => f.type === factoryType).length;
                    
                    div.className = `factory-item ${canAfford && canUnlock ? '' : 'insufficient'}`;
                    
                    div.innerHTML = `
                        <div class="factory-header">
                            <div class="factory-name">${factory.emoji} ${factory.name}</div>
                            <div class="factory-count">æ‹¥æœ‰: ${ownedCount}</div>
                        </div>
                        <div style="font-size: 11px; color: #bbb; margin-bottom: 10px;">${factory.description}</div>
                        <div style="font-size: 10px; color: #888; margin-bottom: 8px;">
                            è§£é”ç­‰çº§: ${factory.unlockLevel} ${canUnlock ? 'âœ…' : 'ğŸ”’'}
                        </div>
                        <div style="font-size: 12px; color: #ddd; margin-bottom: 8px;">
                            å»ºé€ è´¹ç”¨: ${this.formatCost(factory.cost)}
                        </div>
                        <div style="font-size: 11px; color: #00b894; margin-bottom: 8px;">
                            å¯ç”Ÿäº§: ${factory.produces.slice(0, 3).map(p => this.getProductName(p)).join(', ')}${factory.produces.length > 3 ? '...' : ''}
                        </div>
                        <button class="btn build" onclick="game.buildFactory('${factoryType}')" 
                            ${canAfford && canUnlock ? '' : 'disabled'} style="width: 100%;">
                            å»ºé€ å·¥å‚
                        </button>
                    `;
                    
                    container.appendChild(div);
                });
            }

            renderProduction() {
                const container = document.getElementById('production');
                container.innerHTML = '';
                
                if (Object.keys(this.gameData.factories).length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #bbb; margin-top: 50px;">å…ˆå»ºé€ å·¥å‚æ‰èƒ½å¼€å§‹ç”Ÿäº§</div>';
                    return;
                }
                
                Object.keys(this.gameData.factories).forEach(factoryId => {
                    const factory = this.gameData.factories[factoryId];
                    const factoryType = this.factoryTypes[factory.type];
                    const div = document.createElement('div');
                    
                    div.className = 'factory-item';
                    
                    let statusText = 'ç©ºé—²';
                    let progressBar = '';
                    
                    if (factory.currentTask) {
                        const progress = Math.min(100, (Date.now() - factory.currentTask.startTime) / 
                            (factory.currentTask.completionTime - factory.currentTask.startTime) * 100);
                        statusText = `ç”Ÿäº§ä¸­: ${this.getProductName(factory.currentTask.productId)} x${factory.currentTask.quantity}`;
                        progressBar = `
                            <div class="production-progress">
                                <div class="production-progress-bar" style="width: ${progress}%"></div>
                            </div>
                        `;
                    }
                    
                    div.innerHTML = `
                        <div class="factory-header">
                            <div class="factory-name">${factoryType.emoji} ${factoryType.name}</div>
                            <div style="font-size: 12px; color: ${factory.automation ? '#00b894' : '#bbb'};">
                                ${factory.automation ? 'ğŸ¤– è‡ªåŠ¨' : 'ğŸ‘¤ æ‰‹åŠ¨'}
                            </div>
                        </div>
                        <div style="font-size: 12px; color: #ddd; margin-bottom: 8px;">
                            ç­‰çº§: ${factory.level} | æ•ˆç‡: ${Math.floor(factory.efficiency * 100)}%
                        </div>
                        <div style="font-size: 11px; color: #bbb; margin-bottom: 8px;">
                            çŠ¶æ€: ${statusText}
                        </div>
                        ${progressBar}
                        <div style="margin-top: 10px;">
                            <select id="product_${factoryId}" style="width: 60%; margin-right: 5px; padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
                                ${factoryType.produces.map(productId => 
                                    `<option value="${productId}">${this.getProductName(productId)}</option>`
                                ).join('')}
                            </select>
                            <input type="number" id="quantity_${factoryId}" placeholder="æ•°é‡" min="1" value="1" 
                                style="width: 20%; margin-right: 5px; padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
                            <button class="btn" onclick="game.startProduction('${factoryId}')" 
                                style="width: 15%; padding: 5px;">
                                ç”Ÿäº§
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
            }

            renderMarkets() {
                const container = document.getElementById('markets');
                container.innerHTML = '';
                
                const marketGrid = document.createElement('div');
                marketGrid.className = 'market-grid';
                
                Object.keys(this.marketTiers).forEach(marketType => {
                    const marketInfo = this.marketTiers[marketType];
                    const market = this.globalMarkets[marketType] || {};
                    const canAccess = this.gameData.level >= marketInfo.unlockLevel;
                    
                    const marketDiv = document.createElement('div');
                    marketDiv.className = `market-tier ${canAccess ? '' : 'locked'}`;
                    
                    let productsHtml = '';
                    if (canAccess) {
                        Object.keys(market).forEach(productId => {
                            const productData = market[productId];
                            const product = this.getProductByKey(productId);
                            if (product) {
                                const trendIcon = productData.trend > 0 ? 'ğŸ“ˆ' : productData.trend < 0 ? 'ğŸ“‰' : 'â¡ï¸';
                                const tier = this.getProductTier(productId);
                                
                                productsHtml += `
                                    <div class="product-item" style="margin-bottom: 8px; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="font-size: 12px; font-weight: bold;">${product.name}
                                                <span class="tier-badge ${tier}">${tier}</span>
                                            </span>
                                            <span>${trendIcon}</span>
                                        </div>
                                        <div style="font-size: 11px; color: #bbb; margin: 4px 0;">
                                            ä»·æ ¼: ${this.formatNumber(productData.price)} ğŸ’° | åº“å­˜: ${this.formatNumber(this.gameData.inventory[productId] || 0)}
                                        </div>
                                        <div class="multiplier-selector">
                                            <button class="multiplier-btn ${this.selectedMultiplier === 1 ? 'active' : ''}" onclick="game.setMultiplier(1)">1x</button>
                                            <button class="multiplier-btn ${this.selectedMultiplier === 100 ? 'active' : ''}" onclick="game.setMultiplier(100)">100x</button>
                                            <button class="multiplier-btn ${this.selectedMultiplier === 10000 ? 'active' : ''}" onclick="game.setMultiplier(10000)">10K</button>
                                        </div>
                                        <div style="display: flex; gap: 4px; margin-top: 4px;">
                                            <button class="btn buy" style="flex: 1; padding: 4px; font-size: 10px;" 
                                                onclick="game.buyProduct('${productId}', '${marketType}')">
                                                ä¹°å…¥
                                            </button>
                                            <button class="btn sell" style="flex: 1; padding: 4px; font-size: 10px;" 
                                                onclick="game.sellProduct('${productId}', '${marketType}')">
                                                å–å‡º
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }
                        });
                    } else {
                        productsHtml = `<div style="text-align: center; color: #bbb; margin-top: 20px;">éœ€è¦ç­‰çº§ ${marketInfo.unlockLevel} è§£é”</div>`;
                    }
                    
                    marketDiv.innerHTML = `
                        <div class="market-tier-header">
                            ${marketInfo.emoji} ${marketInfo.name}
                            ${canAccess ? 'âœ…' : 'ğŸ”’'}
                        </div>
                        <div style="font-size: 11px; color: #bbb; margin-bottom: 10px;">
                            ${marketInfo.description}
                        </div>
                        <div class="product-list">
                            ${productsHtml}
                        </div>
                    `;
                    
                    marketGrid.appendChild(marketDiv);
                });
                
                container.appendChild(marketGrid);
            }

            renderResearch() {
                const container = document.getElementById('research');
                container.innerHTML = '';
                
                Object.keys(this.techTree).forEach(techId => {
                    const tech = this.techTree[techId];
                    const div = document.createElement('div');
                    
                    const canAfford = this.canAfford(tech.cost);
                    const canUnlock = this.gameData.level >= tech.unlockLevel;
                    const isResearched = this.gameData.technologies.includes(techId);
                    const requirementsMet = !tech.requires || tech.requires.every(reqTech => this.gameData.technologies.includes(reqTech));
                    
                    div.className = `tech-item ${canAfford && canUnlock && requirementsMet && !isResearched ? '' : 'insufficient'}`;
                    
                    let requirementsText = '';
                    if (tech.requires) {
                        requirementsText = `<div style="font-size: 10px; color: #888; margin-bottom: 6px;">
                            å‰ç½®ç§‘æŠ€: ${tech.requires.map(reqTech => 
                                this.techTree[reqTech] ? this.techTree[reqTech].name : reqTech
                            ).join(', ')}
                        </div>`;
                    }
                    
                    div.innerHTML = `
                        <div class="tech-header">
                            <div class="tech-name">ğŸ”¬ ${tech.name}</div>
                            <div style="font-size: 12px; color: ${isResearched ? '#00b894' : '#bbb'};">
                                ${isResearched ? 'âœ… å·²ç ”å‘' : 'ğŸ”¬ å¾…ç ”å‘'}
                            </div>
                        </div>
                        <div style="font-size: 11px; color: #bbb; margin-bottom: 8px;">${tech.description}</div>
                        <div style="font-size: 10px; color: #888; margin-bottom: 6px;">
                            è§£é”ç­‰çº§: ${tech.unlockLevel} ${canUnlock ? 'âœ…' : 'ğŸ”’'}
                        </div>
                        ${requirementsText}
                        <div style="font-size: 12px; color: #ddd; margin-bottom: 8px;">
                            ç ”å‘è´¹ç”¨: ${this.formatCost(tech.cost)}
                        </div>
                        <div style="font-size: 11px; color: #00b894; margin-bottom: 8px;">
                            æ•ˆæœ: ${tech.effect}
                        </div>
                        <button class="btn" onclick="game.researchTech('${techId}')" 
                            ${canAfford && canUnlock && requirementsMet && !isResearched ? '' : 'disabled'} style="width: 100%;">
                            ${isResearched ? 'å·²ç ”å‘' : 'å¼€å§‹ç ”å‘'}
                        </button>
                    `;
                    
                    container.appendChild(div);
                });
            }

            renderAutomation() {
                const container = document.getElementById('automation');
                container.innerHTML = '';
                
                if (Object.keys(this.gameData.factories).length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #bbb; margin-top: 50px;">å…ˆå»ºé€ å·¥å‚æ‰èƒ½è®¾ç½®è‡ªåŠ¨åŒ–</div>';
                    return;
                }
                
                const hasAutomationTech = this.gameData.technologies.includes('automation_2');
                
                if (!hasAutomationTech) {
                    container.innerHTML = `
                        <div style="text-align: center; color: #bbb; margin-top: 50px;">
                            <div style="margin-bottom: 15px;">éœ€è¦ç ”å‘"é«˜çº§è‡ªåŠ¨åŒ–"æŠ€æœ¯æ‰èƒ½è®¾ç½®è‡ªåŠ¨åŒ–</div>
                            <button class="btn" onclick="switchTab('research')" style="padding: 10px 20px;">
                                å‰å¾€ç ”å‘
                            </button>
                        </div>
                    `;
                    return;
                }
                
                Object.keys(this.gameData.factories).forEach(factoryId => {
                    const factory = this.gameData.factories[factoryId];
                    const factoryType = this.factoryTypes[factory.type];
                    const div = document.createElement('div');
                    
                    div.className = 'factory-item';
                    
                    div.innerHTML = `
                        <div class="factory-header">
                            <div class="factory-name">${factoryType.emoji} ${factoryType.name}</div>
                            <div style="font-size: 12px; color: ${factory.automation ? '#00b894' : '#e74c3c'};">
                                ${factory.automation ? 'ğŸ¤– å·²å¯ç”¨' : 'ğŸ‘¤ æ‰‹åŠ¨æ¨¡å¼'}
                            </div>
                        </div>
                        <div style="font-size: 11px; color: #bbb; margin-bottom: 10px;">
                            è‡ªåŠ¨åŒ–å¯ä»¥è®©å·¥å‚è‡ªåŠ¨æ‰§è¡Œé¢„è®¾çš„ç”Ÿäº§ä»»åŠ¡
                        </div>
                        <div style="margin-top: 10px;">
                            <button class="btn ${factory.automation ? 'sell' : 'buy'}" 
                                onclick="game.toggleAutomation('${factoryId}')" style="width: 100%;">
                                ${factory.automation ? 'å…³é—­è‡ªåŠ¨åŒ–' : 'å¯ç”¨è‡ªåŠ¨åŒ–'}
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
            }

            renderLeaderboard() {
                const container = document.getElementById('leaderboard');
                container.innerHTML = '';
                
                this.leaderboard.slice(0, 10).forEach((company, index) => {
                    const div = document.createElement('div');
                    div.className = `company-rank ${company.isPlayer ? 'player' : 'ai'}`;
                    
                    const typeEmoji = this.getCompanyTypeEmoji(company.companyType);
                    
                    div.innerHTML = `
                        <div class="rank-number">#${index + 1}</div>
                        <div class="rank-info">
                            <div class="rank-name">
                                ${typeEmoji} ${company.name} ${company.isPlayer ? '(ä½ )' : ''}
                                <span style="font-size: 10px; color: #bbb; margin-left: 5px;">Lv.${company.level || 0}</span>
                            </div>
                            <div class="rank-value">
                                ä»·å€¼: ${this.formatNumber(company.value)} ğŸ’°
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
            }

            renderChat() {
                const container = document.getElementById('chatMessages');
                container.innerHTML = '';
                
                this.chatMessages.slice(-15).forEach(msg => {
                    const div = document.createElement('div');
                    div.className = 'chat-message';
                    
                    const time = new Date(msg.timestamp).toLocaleTimeString().slice(0, 5);
                    const isSystem = msg.player === 'ç³»ç»Ÿ' || msg.player === 'å¸‚åœºå¿«è®¯' || msg.player === 'å…¨çƒäº‹ä»¶';
                    
                    div.innerHTML = `
                        <span class="chat-time">[${time}]</span>
                        <span class="chat-player" style="color: ${isSystem ? '#e17055' : '#fdcb6e'};">${msg.player}:</span>
                        <span class="chat-text">${msg.message}</span>
                    `;
                    
                    container.appendChild(div);
                });
                
                container.scrollTop = container.scrollHeight;
            }

            updateDisplay() {
                // æ›´æ–°åº“å­˜æ˜¾ç¤º
                const inventoryContainer = document.getElementById('inventory');
                inventoryContainer.innerHTML = '';
                
                Object.keys(this.gameData.inventory).forEach(item => {
                    const quantity = this.gameData.inventory[item];
                    if (quantity > 0) {
                        const div = document.createElement('div');
                        const tier = this.getProductTier(item);
                        div.className = `inventory-item ${tier ? tier.toLowerCase() : 'money'}`;
                        
                        if (item === 'money') {
                            div.innerHTML = `ğŸ’° èµ„é‡‘<br><strong>${this.formatNumber(quantity)}</strong>`;
                        } else {
                            const product = this.getProductByKey(item);
                            div.innerHTML = `${product ? product.name : item}<br><strong>${this.formatNumber(quantity)}</strong>`;
                        }
                        
                        inventoryContainer.appendChild(div);
                    }
                });
            }

            updateCompanyStats() {
                const myCompany = this.leaderboard.find(c => c.name === this.companyName);
                const myRank = this.leaderboard.findIndex(c => c.name === this.companyName) + 1;
                
                document.getElementById('globalRank').textContent = myRank > 0 ? `#${myRank}` : '#-';
                document.getElementById('onlineCount').textContent = this.leaderboard.filter(c => c.isPlayer && c.online !== false).length;
                document.getElementById('companyValue').textContent = myCompany ? this.formatNumber(myCompany.value) : '0';
                document.getElementById('experience').textContent = this.formatNumber(this.gameData.experience);
                document.getElementById('companyLevel').textContent = this.gameData.level;
            }

            updateProductionChart() {
                if (!this.productionChart) return;
                
                const tierCounts = { T1: 0, T2: 0, T3: 0, T4: 0, T5: 0 };
                
                Object.keys(this.gameData.inventory).forEach(item => {
                    if (item !== 'money') {
                        const tier = this.getProductTier(item);
                        if (tier && tierCounts[tier] !== undefined) {
                            tierCounts[tier] += this.gameData.inventory[item] || 0;
                        }
                    }
                });
                
                this.productionChart.data.datasets[0].data = Object.values(tierCounts);
                this.productionChart.update();
            }

            // æ¸¸æˆæ“ä½œæ–¹æ³•
            buildFactory(factoryType) {
                this.socket.emit('buildFactory', { factoryType });
            }

            startProduction(factoryId) {
                const productSelect = document.getElementById(`product_${factoryId}`);
                const quantityInput = document.getElementById(`quantity_${factoryId}`);
                
                const productId = productSelect.value;
                const quantity = parseInt(quantityInput.value) || 1;
                
                this.socket.emit('startProduction', {
                    factoryId: factoryId,
                    productId: productId,
                    quantity: quantity
                });
            }

           setMultiplier(multiplier) {
                this.selectedMultiplier = multiplier;
                this.renderMarkets();
            }

            buyProduct(productId, marketType) {
                this.socket.emit('marketTrade', {
                    action: 'buy',
                    productId: productId,
                    quantity: 1,
                    marketType: marketType,
                    multiplier: this.selectedMultiplier
                });
            }

            sellProduct(productId, marketType) {
                this.socket.emit('marketTrade', {
                    action: 'sell',
                    productId: productId,
                    quantity: 1,
                    marketType: marketType,
                    multiplier: this.selectedMultiplier
                });
            }

            researchTech(techId) {
                this.socket.emit('researchTech', { techId });
            }

            toggleAutomation(factoryId) {
                // è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªåŠ¨åŒ–åˆ‡æ¢é€»è¾‘
                const factory = this.gameData.factories[factoryId];
                if (factory) {
                    factory.automation = !factory.automation;
                    this.showNotification(`ğŸ¤– ${factory.automation ? 'å¯ç”¨' : 'å…³é—­'}äº†å·¥å‚è‡ªåŠ¨åŒ–`);
                    this.renderAutomation();
                    this.socket.emit('updateGameData', this.gameData);
                }
            }

            sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (message && this.companyName) {
                    this.socket.emit('chatMessage', message);
                    input.value = '';
                }
            }

            // è¾…åŠ©æ–¹æ³•
            getProductByKey(productId) {
                for (const tier of Object.values(this.productTiers)) {
                    if (tier[productId]) {
                        return tier[productId];
                    }
                }
                return null;
            }

            getProductName(productId) {
                const product = this.getProductByKey(productId);
                return product ? product.name : productId;
            }

            getProductTier(productId) {
                for (const [tierName, products] of Object.entries(this.productTiers)) {
                    if (products[productId]) {
                        return tierName;
                    }
                }
                return null;
            }

            getCompanyTypeEmoji(companyType) {
                const emojis = {
                    tech: 'ğŸ’»',
                    manufacturing: 'ğŸ­',
                    luxury: 'ğŸ’',
                    energy: 'âš¡'
                };
                return emojis[companyType] || 'ğŸ¢';
            }

            canAfford(cost) {
                return Object.keys(cost).every(item => 
                    (this.gameData.inventory[item] || 0) >= cost[item]);
            }

            formatNumber(num) {
                if (num >= 1000000000) {
                    return (num / 1000000000).toFixed(1) + 'B';
                } else if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                } else {
                    return Math.floor(num).toString();
                }
            }

            formatCost(cost) {
                return Object.keys(cost).map(item => {
                    if (item === 'money') {
                        return `${this.formatNumber(cost[item])}ğŸ’°`;
                    } else {
                        const product = this.getProductByKey(item);
                        return `${this.formatNumber(cost[item])}${product ? product.name : item}`;
                    }
                }).join(' ');
            }
        }
        
        // å…¨å±€å˜é‡
        let game;
        
        // å…¨å±€å‡½æ•°
        function joinGame() {
            if (!game) {
                game = new ManufacturingTycoon();
            }
            game.joinGame();
        }
        
        function sendMessage() {
            if (game) {
                game.sendMessage();
            }
        }
        
        function switchTab(tabName) {
            if (game) {
                game.switchTab(tabName);
            }
        }
        
        window.onload = () => {
            game = new ManufacturingTycoon();
        };
        
        // é˜²æ­¢æ„å¤–å…³é—­
        window.onbeforeunload = () => {
            if (game && game.companyName) {
                // å¯ä»¥åœ¨è¿™é‡Œä¿å­˜æ¸¸æˆçŠ¶æ€
            }
        };
    </script>
</body>
</html>
